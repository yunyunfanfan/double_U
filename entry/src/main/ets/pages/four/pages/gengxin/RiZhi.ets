import { router } from '@kit.ArkUI'
import { JhTextList, ItemType, JhSetCell, JhProgressHUD, JhAESPreferencesUtils, kUserDefault_UserInfo, JhAlert } from 'JhCommon'

interface LocalItemType {
  label: Resource | string
}

@Entry
@Preview
@Component
export struct SetPage {
  private _rowSpace: number = 24
  private _cellH: number = 72
  private _paddingValue: number = 24

  private localDataArr: LocalItemType[] = [
    { label: $r('app.string.no_update_log') },
  ]

  @State dataArr: ItemType[] = []

  aboutToAppear(): void {
    console.info('ğŸš€ SetPage - é¡µé¢å³å°†å‡ºç°ï¼Œå¼€å§‹åˆå§‹åŒ–æ•°æ®')
    this.initializeData()
  }

  private initializeData(): void {
    console.info('ğŸ“Š SetPage - å¼€å§‹è½¬æ¢Resourceåˆ°string')
    try {
      const context = getContext(this)
      this.dataArr = this.localDataArr.map((item: LocalItemType, index: number) => {
        const labelStr = context.resourceManager.getStringSync((item.label as Resource).id)
        console.info(`âœ… SetPage - ç¬¬${index}é¡¹è½¬æ¢æˆåŠŸ: ${labelStr}`)
        return { label: labelStr } as ItemType
      })
      console.info('ğŸ‰ SetPage - æ‰€æœ‰æ•°æ®è½¬æ¢å®Œæˆ')
    } catch (error) {
      console.error('âŒ SetPage - æ•°æ®è½¬æ¢å¤±è´¥', error)
      this.dataArr = [{ label: 'æ— æ›´æ–°æ—¥å¿—' }] as ItemType[]
    }
  }

  build() {
    Scroll() {
      Column() {
        JhTextList({
          title: '',
          dataArr: this.dataArr,  // âœ… æ­£ç¡®çš„ItemType[]ç±»å‹
          callBack: (index: number, text: string) => {
            console.info('ğŸ” SetPage - ç”¨æˆ·ç‚¹å‡»åˆ—è¡¨é¡¹', `ç´¢å¼•: ${index}, æ–‡æœ¬: ${text}`)
            const cleanText = text.replace(/[^\u4e00-\u9fa5]/g, '')
            console.info('ğŸ§¹ SetPage - æ¸…ç†åçš„æ–‡æœ¬', `åŸæ–‡: ${text}, æ¸…ç†å: ${cleanText}`)
            this.handleCellClick(cleanText)
          }
        })
          .margin({ bottom: this._rowSpace, top: 8 })
      }
      .padding({
        top: 4,
        bottom: 14,
        left: this._paddingValue,
        right: this._paddingValue
      })
      .width('100%')
    }
    .backgroundColor(0xF5F6FA)
  }

  private handleCellClick(text: string): void {
    console.info('ğŸ¯ SetPage - å¤„ç†å•å…ƒæ ¼ç‚¹å‡»', `æ–‡æœ¬å†…å®¹: ${text}`)
    switch (text) {
      default:
        console.info('âš ï¸ SetPage - æœªå¤„ç†çš„ç‚¹å‡»é¡¹', `æ–‡æœ¬: ${text}`)
        break
    }
  }
}