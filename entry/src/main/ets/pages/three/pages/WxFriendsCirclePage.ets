///  WxFriendsCirclePage.ets
///
///  Created by iotjin on 2024/11/28.
///  description: å¥åº·åœˆ - å¥åº·ç¤¾åŒºåˆ†äº«å¹³å°

import { router } from '@kit.ArkUI';
import { BaseNavigation, JhProgressHUD, KColors } from 'JhCommon'

// å¥åº·åŠ¨æ€ç±»åž‹æžšä¸¾
enum HealthPostType {
  EXERCISE = 'exercise',
  DIET = 'diet',
  SLEEP = 'sleep',
  MOOD = 'mood',
  CHALLENGE = 'challenge',
  KNOWLEDGE = 'knowledge'
}

// åŠ¨æ€ç±»åž‹é€‰é¡¹æŽ¥å£
interface PostTypeOption {
  type: HealthPostType
  name: string
  icon: string
}

// å¥åº·åŠ¨æ€æ¨¡åž‹
class HealthPost {
  id: string
  authorName: string
  authorAvatar: string
  authorLevel: string
  postType: HealthPostType
  title: string
  content: string
  images: string[]
  healthData: HealthMetrics
  timestamp: string
  likes: number
  comments: number
  isLiked: boolean
  tags: string[]

  constructor(id: string, authorName: string, authorAvatar: string, authorLevel: string,
    postType: HealthPostType, title: string, content: string, images: string[],
    healthData: HealthMetrics, timestamp: string, likes: number, comments: number,
    isLiked: boolean, tags: string[]) {
    this.id = id
    this.authorName = authorName
    this.authorAvatar = authorAvatar
    this.authorLevel = authorLevel
    this.postType = postType
    this.title = title
    this.content = content
    this.images = images
    this.healthData = healthData
    this.timestamp = timestamp
    this.likes = likes
    this.comments = comments
    this.isLiked = isLiked
    this.tags = tags
  }
}

// å¥åº·æŒ‡æ ‡æ¨¡åž‹
class HealthMetrics {
  steps?: number
  calories?: number
  heartRate?: number
  sleepHours?: number
  weight?: number

  constructor(steps?: number, calories?: number, heartRate?: number, sleepHours?: number, weight?: number) {
    this.steps = steps
    this.calories = calories
    this.heartRate = heartRate
    this.sleepHours = sleepHours
    this.weight = weight
  }
}

// å¥åº·æŒ‘æˆ˜æ¨¡åž‹
class HealthChallenge {
  id: string
  title: string
  description: string
  detailedDescription: string
  icon: string
  participants: number
  duration: string
  reward: string
  progress: number
  category: string
  difficulty: string
  benefits: string[]
  dailyGoals: string[]
  tips: string[]
  startDate: string
  endDate: string

  constructor(id: string, title: string, description: string, detailedDescription: string, icon: string,
    participants: number, duration: string, reward: string, progress: number, category: string,
    difficulty: string, benefits: string[], dailyGoals: string[], tips: string[],
    startDate: string, endDate: string) {
    this.id = id
    this.title = title
    this.description = description
    this.detailedDescription = detailedDescription
    this.icon = icon
    this.participants = participants
    this.duration = duration
    this.reward = reward
    this.progress = progress
    this.category = category
    this.difficulty = difficulty
    this.benefits = benefits
    this.dailyGoals = dailyGoals
    this.tips = tips
    this.startDate = startDate
    this.endDate = endDate
  }
}

// æ–°å¢žï¼šå‘å¸ƒåŠ¨æ€çš„æ•°æ®æ¨¡åž‹
class NewPostData {
  postType: HealthPostType
  title: string
  content: string
  tags: string[]
  healthData: HealthMetrics

  constructor() {
    this.postType = HealthPostType.EXERCISE
    this.title = ''
    this.content = ''
    this.tags = []
    this.healthData = new HealthMetrics()
  }
}

@Entry
@Component
struct WxFriendsCirclePage {
  @State healthPosts: HealthPost[] = []
  @State healthChallenges: HealthChallenge[] = []
  @State selectedTab: number = 0
  @State showPostDialog: boolean = false
  @State showChallengeDetailDialog: boolean = false
  @State selectedChallenge: HealthChallenge | null = null
  @State newPostData: NewPostData = new NewPostData()
  @State inputTitle: string = ''
  @State inputContent: string = ''
  @State selectedPostType: HealthPostType = HealthPostType.EXERCISE
  @State inputTags: string = ''
  private tabs: string[] = ['åŠ¨æ€', 'æŒ‘æˆ˜', 'çŸ¥è¯†', 'æˆ‘çš„']
  private postTypes: PostTypeOption[] = []
  scroller: Scroller = new Scroller()

  aboutToAppear() {
    this.initPostTypes()
    this.loadHealthData()
  }

  // åˆå§‹åŒ–åŠ¨æ€ç±»åž‹é€‰é¡¹
  initPostTypes() {
    this.postTypes = [
      { type: HealthPostType.EXERCISE, name: 'è¿åŠ¨', icon: 'ðŸƒâ€â™‚ï¸' },
      { type: HealthPostType.DIET, name: 'é¥®é£Ÿ', icon: 'ðŸ¥—' },
      { type: HealthPostType.SLEEP, name: 'ç¡çœ ', icon: 'ðŸ˜´' },
      { type: HealthPostType.MOOD, name: 'æƒ…ç»ª', icon: 'ðŸ˜Š' },
      { type: HealthPostType.CHALLENGE, name: 'æŒ‘æˆ˜', icon: 'ðŸ†' },
      { type: HealthPostType.KNOWLEDGE, name: 'çŸ¥è¯†', icon: 'ðŸ“š' }
    ]
  }

  build() {
    Stack() {
      Column() {
        // é¡¶éƒ¨å¯¼èˆªæ 
        this.buildNavigationBar()

        // æ ‡ç­¾é¡µåˆ‡æ¢
        this.buildTabBar()

        // å†…å®¹åŒºåŸŸ
        this.buildContentArea()
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#F8F9FA')

      // å‘å¸ƒåŠ¨æ€å¼¹çª—
      if (this.showPostDialog) {
        this.buildPostDialog()
      }

      // æŒ‘æˆ˜è¯¦æƒ…å¼¹çª—
      if (this.showChallengeDetailDialog && this.selectedChallenge) {
        this.buildChallengeDetailDialog()
      }
    }
    .width('100%')
    .height('100%')
  }

  @Builder
  buildNavigationBar() {
    Row() {
      Button({ type: ButtonType.Circle, stateEffect: true }) {
        Image($r('app.media.ic_back'))
          .width(20)
          .height(20)
      }
      .onClick(() => {
        try {
          router.back();
        } catch (err) {
          console.error('Failed to go back:', err);
          router.pushUrl({ url: 'pages/three/pages/WxDiscoverPage' });
        }
      })
      .width(40)
      .height(40)
      .backgroundColor(Color.Transparent)
      .margin({ left: 10 })

      Text('å¥åº·åœˆ')
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
        .fontColor(Color.Black)
        .layoutWeight(1)
        .textAlign(TextAlign.Center)

      // å‘å¸ƒæŒ‰é’®
      Button({ type: ButtonType.Circle, stateEffect: true }) {
        Text('âœï¸')
          .fontSize(20)
      }
      .onClick(() => {
        this.showPostDialog = true;
      })
      .width(40)
      .height(40)
      .backgroundColor('#4CAF50')
      .margin({ right: 10 })
    }
    .width('100%')
    .height(60)
    .justifyContent(FlexAlign.SpaceBetween)
    .alignItems(VerticalAlign.Center)
    .backgroundColor('#FFFFFF')
    .shadow({
      radius: 4,
      color: 'rgba(0,0,0,0.1)',
      offsetX: 0,
      offsetY: 2
    })
  }

  @Builder
  buildTabBar() {
    Row() {
      ForEach(this.tabs, (tab: string, index: number) => {
        Column() {
          Text(tab)
            .fontSize(16)
            .fontColor(this.selectedTab === index ? '#4CAF50' : '#666666')
            .fontWeight(this.selectedTab === index ? FontWeight.Bold : FontWeight.Normal)
            .padding({ top: 12, bottom: 8 })

          if (this.selectedTab === index) {
            Divider()
              .width(30)
              .height(3)
              .color('#4CAF50')
              .borderRadius(2)
          }
        }
        .layoutWeight(1)
        .onClick(() => {
          this.selectedTab = index;
        })
      })
    }
    .width('100%')
    .height(50)
    .backgroundColor('#FFFFFF')
    .margin({ bottom: 4 })
  }

  @Builder
  buildContentArea() {
    if (this.selectedTab === 0) {
      this.buildHealthPostsTab()
    } else if (this.selectedTab === 1) {
      this.buildChallengesTab()
    } else if (this.selectedTab === 2) {
      this.buildKnowledgeTab()
    } else {
      this.buildMyTab()
    }
  }

  @Builder
  buildHealthPostsTab() {
    Scroll(this.scroller) {
      Column({ space: 12 }) {
        // ä»Šæ—¥å¥åº·æ¦‚è§ˆå¡ç‰‡
        this.buildTodayHealthOverview()

        // å¥åº·åŠ¨æ€åˆ—è¡¨
        ForEach(this.healthPosts, (post: HealthPost) => {
          this.buildHealthPostCard(post)
        })
      }
      .padding({ left: 16, right: 16, bottom: 20 })
    }
    .layoutWeight(1)
    .scrollBar(BarState.Off)
  }

  @Builder
  buildTodayHealthOverview() {
    Column() {
      Row() {
        Text('ä»Šæ—¥å¥åº·æ¦‚è§ˆ')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')

        Blank()

        Text('æŸ¥çœ‹è¯¦æƒ… >')
          .fontSize(14)
          .fontColor('#4CAF50')
          .onClick(() => {
            // æš‚æ—¶ä½¿ç”¨æç¤ºä¿¡æ¯ï¼Œé¿å…è·³è½¬å¤±è´¥
            JhProgressHUD.showText('å¥åº·æ•°æ®è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­...');
          })
      }
      .width('100%')
      .margin({ bottom: 16 })

      Row({ space: 12 }) {
        this.buildMetricCard('æ­¥æ•°', '8,756', 'æ­¥', '#2196F3', 'ðŸš¶â€â™‚ï¸')
        this.buildMetricCard('çƒ­é‡', '2,345', 'Kcal', '#FF9800', 'ðŸ”¥')
        this.buildMetricCard('å¿ƒçŽ‡', '72', 'bpm', '#E91E63', 'â¤ï¸')
      }
      .width('100%')
    }
    .width('100%')
    .padding(20)
    .backgroundColor('#FFFFFF')
    .borderRadius(16)
    .shadow({
      radius: 8,
      color: 'rgba(0,0,0,0.06)',
      offsetX: 0,
      offsetY: 3
    })
  }

  @Builder
  buildMetricCard(title: string, value: string, unit: string, color: string, emoji: string) {
    Column() {
      Text(emoji)
        .fontSize(24)
        .margin({ bottom: 8 })

      Text(value)
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .fontColor(color)

      Text(unit)
        .fontSize(12)
        .fontColor('#999999')
        .margin({ top: 2, bottom: 4 })

      Text(title)
        .fontSize(14)
        .fontColor('#666666')
    }
    .layoutWeight(1)
    .padding(12)
    .backgroundColor('#F8F9FA')
    .borderRadius(12)
    .alignItems(HorizontalAlign.Center)
  }

  @Builder
  buildHealthPostCard(post: HealthPost) {
    Column() {
      // ç”¨æˆ·ä¿¡æ¯è¡Œ
      Row() {
        Row() {
          Text(post.authorName.substring(0, 1))
            .fontSize(16)
            .fontColor('#FFFFFF')
            .textAlign(TextAlign.Center)
            .width(40)
            .height(40)
            .borderRadius(20)
            .backgroundColor('#4CAF50')
        }
        .margin({ right: 12 })

        Column() {
          Row() {
            Text(post.authorName)
              .fontSize(16)
              .fontWeight(FontWeight.Medium)
              .fontColor('#333333')

            Text(post.authorLevel)
              .fontSize(12)
              .fontColor('#4CAF50')
              .padding({ left: 6, right: 6, top: 2, bottom: 2 })
              .backgroundColor('#E8F5E8')
              .borderRadius(10)
              .margin({ left: 8 })
          }

          Text(post.timestamp)
            .fontSize(12)
            .fontColor('#999999')
            .margin({ top: 2 })
        }
        .alignItems(HorizontalAlign.Start)
        .layoutWeight(1)

        Text(this.getPostTypeIcon(post.postType))
          .fontSize(20)
      }
      .width('100%')
      .margin({ bottom: 12 })

      // å†…å®¹åŒºåŸŸ
      Column() {
        if (post.title) {
          Text(post.title)
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor('#333333')
            .width('100%')
            .textAlign(TextAlign.Start)
            .margin({ bottom: 8 })
        }

        Text(post.content)
          .fontSize(14)
          .fontColor('#666666')
          .width('100%')
          .textAlign(TextAlign.Start)
          .maxLines(3)
          .textOverflow({ overflow: TextOverflow.Ellipsis })
          .margin({ bottom: 12 })

        // å¥åº·æ•°æ®å±•ç¤º
        if (post.healthData) {
          this.buildPostHealthData(post.healthData)
        }

        // æ ‡ç­¾
        if (post.tags.length > 0) {
          Row() {
            ForEach(post.tags, (tag: string) => {
              Text(`#${tag}`)
                .fontSize(12)
                .fontColor('#4CAF50')
                .padding({ left: 8, right: 8, top: 4, bottom: 4 })
                .backgroundColor('#E8F5E8')
                .borderRadius(12)
                .margin({ right: 8 })
            })
          }
          .width('100%')
          .margin({ top: 8, bottom: 12 })
        }
      }
      .width('100%')

      // äº’åŠ¨åŒºåŸŸ
      Row() {
        Row() {
          Text(post.isLiked ? 'â¤ï¸' : 'ðŸ¤')
            .fontSize(16)
            .onClick(() => {
              this.togglePostLike(post);
            })

          Text(post.likes.toString())
            .fontSize(14)
            .fontColor('#666666')
            .margin({ left: 4 })
        }
        .margin({ right: 20 })

        Row() {
          Text('ðŸ’¬')
            .fontSize(16)

          Text(post.comments.toString())
            .fontSize(14)
            .fontColor('#666666')
            .margin({ left: 4 })
        }
        .margin({ right: 20 })

        Blank()

        Text('åˆ†äº«')
          .fontSize(14)
          .fontColor('#4CAF50')
          .onClick(() => {
            JhProgressHUD.showText('åˆ†äº«åŠŸèƒ½å¼€å‘ä¸­...');
          })
      }
      .width('100%')
      .padding({ top: 12 })
      .border({
        width: { top: 1 },
        color: '#F0F0F0'
      })
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#FFFFFF')
    .borderRadius(12)
    .shadow({
      radius: 6,
      color: 'rgba(0,0,0,0.05)',
      offsetX: 0,
      offsetY: 2
    })
  }

  @Builder
  buildPostHealthData(healthData: HealthMetrics) {
    Row({ space: 12 }) {
      if (healthData.steps) {
        this.buildDataChip('ðŸš¶â€â™‚ï¸', healthData.steps.toString(), 'æ­¥')
      }
      if (healthData.calories) {
        this.buildDataChip('ðŸ”¥', healthData.calories.toString(), 'Kcal')
      }
      if (healthData.heartRate) {
        this.buildDataChip('â¤ï¸', healthData.heartRate.toString(), 'bpm')
      }
      if (healthData.sleepHours) {
        this.buildDataChip('ðŸ˜´', healthData.sleepHours.toString(), 'h')
      }
    }
    .width('100%')
    .margin({ bottom: 8 })
  }

  @Builder
  buildDataChip(icon: string, value: string, unit: string) {
    Row() {
      Text(icon)
        .fontSize(14)
        .margin({ right: 4 })

      Text(`${value}${unit}`)
        .fontSize(12)
        .fontColor('#666666')
    }
    .padding({ left: 8, right: 8, top: 4, bottom: 4 })
    .backgroundColor('#F8F9FA')
    .borderRadius(12)
  }

  @Builder
  buildChallengesTab() {
    Scroll() {
      Column({ space: 16 }) {
        Text('å¥åº·æŒ‘æˆ˜')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')
          .width('100%')
          .textAlign(TextAlign.Start)

        ForEach(this.healthChallenges, (challenge: HealthChallenge) => {
          this.buildChallengeCard(challenge)
        })
      }
      .padding({ left: 16, right: 16, bottom: 20 })
    }
    .layoutWeight(1)
    .scrollBar(BarState.Off)
  }

  @Builder
  buildChallengeCard(challenge: HealthChallenge) {
    Column() {
      // å¤´éƒ¨ä¿¡æ¯
      Row() {
        Text(challenge.icon)
          .fontSize(32)
          .margin({ right: 16 })

        Column() {
          Row() {
            Text(challenge.title)
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .fontColor('#333333')

            Blank()

            // éš¾åº¦æ ‡ç­¾
            Text(challenge.difficulty)
              .fontSize(12)
              .fontColor('#FFFFFF')
              .padding({ left: 8, right: 8, top: 4, bottom: 4 })
              .backgroundColor(this.getDifficultyColor(challenge.difficulty))
              .borderRadius(10)
          }
          .width('100%')

          Text(challenge.category)
            .fontSize(12)
            .fontColor('#4CAF50')
            .margin({ top: 4, bottom: 6 })

          Text(challenge.description)
            .fontSize(14)
            .fontColor('#666666')
            .width('100%')
            .textAlign(TextAlign.Start)
            .maxLines(2)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)
      }
      .width('100%')
      .margin({ bottom: 16 })

      // æŒ‘æˆ˜ç»Ÿè®¡ä¿¡æ¯
      Row() {
        Column() {
          Text(challenge.participants.toString())
            .fontSize(16)
            .fontWeight(FontWeight.Bold)
            .fontColor('#4CAF50')

          Text('å‚ä¸Žäººæ•°')
            .fontSize(11)
            .fontColor('#999999')
        }
        .alignItems(HorizontalAlign.Center)

        Column() {
          Text(challenge.duration)
            .fontSize(16)
            .fontWeight(FontWeight.Bold)
            .fontColor('#FF9800')

          Text('æŒ‘æˆ˜æ—¶é•¿')
            .fontSize(11)
            .fontColor('#999999')
        }
        .alignItems(HorizontalAlign.Center)

        Column() {
          Text(challenge.reward)
            .fontSize(16)
            .fontWeight(FontWeight.Bold)
            .fontColor('#E91E63')

          Text('å¥–åŠ±ç§¯åˆ†')
            .fontSize(11)
            .fontColor('#999999')
        }
        .alignItems(HorizontalAlign.Center)

        Column() {
          Text(`${challenge.progress}%`)
            .fontSize(16)
            .fontWeight(FontWeight.Bold)
            .fontColor('#2196F3')

          Text('æˆ‘çš„è¿›åº¦')
            .fontSize(11)
            .fontColor('#999999')
        }
        .alignItems(HorizontalAlign.Center)
      }
      .width('100%')
      .justifyContent(FlexAlign.SpaceAround)
      .margin({ bottom: 16 })

      // è¿›åº¦æ¡
      Progress({
        value: challenge.progress,
        total: 100,
        type: ProgressType.Linear
      })
        .width('100%')
        .height(6)
        .color('#4CAF50')
        .backgroundColor('#F0F0F0')
        .margin({ bottom: 16 })

      // ä¸»è¦å¥½å¤„ï¼ˆæ˜¾ç¤ºå‰3ä¸ªï¼‰
      if (challenge.benefits.length > 0) {
        Column() {
          Text('ä¸»è¦å¥½å¤„')
            .fontSize(14)
            .fontWeight(FontWeight.Medium)
            .fontColor('#333333')
            .width('100%')
            .textAlign(TextAlign.Start)
            .margin({ bottom: 8 })

          ForEach(challenge.benefits.slice(0, 3), (benefit: string, index: number) => {
            Row() {
              Text('âœ“')
                .fontSize(12)
                .fontColor('#4CAF50')
                .margin({ right: 6 })

              Text(benefit)
                .fontSize(12)
                .fontColor('#666666')
                .layoutWeight(1)
            }
            .width('100%')
            .margin({ bottom: 4 })
          })
        }
        .width('100%')
        .margin({ bottom: 16 })
      }

      // æ“ä½œæŒ‰é’®åŒºåŸŸ
      Row() {
        Button('æŸ¥çœ‹è¯¦æƒ…')
          .width('45%')
          .height(36)
          .fontSize(14)
          .fontColor('#4CAF50')
          .backgroundColor('#E8F5E8')
          .borderRadius(18)
          .onClick(() => {
            this.selectedChallenge = challenge;
            this.showChallengeDetailDialog = true;
          })

        Blank()

        Button(challenge.progress > 0 ? 'ç»§ç»­æŒ‘æˆ˜' : 'å‚ä¸ŽæŒ‘æˆ˜')
          .width('45%')
          .height(36)
          .fontSize(14)
          .fontColor('#FFFFFF')
          .backgroundColor(challenge.progress > 0 ? '#FF9800' : '#4CAF50')
          .borderRadius(18)
          .onClick(() => {
            this.joinChallenge(challenge);
          })
      }
      .width('100%')
    }
    .width('100%')
    .padding(20)
    .backgroundColor('#FFFFFF')
    .borderRadius(16)
    .shadow({
      radius: 8,
      color: 'rgba(0,0,0,0.06)',
      offsetX: 0,
      offsetY: 3
    })
  }

  // èŽ·å–éš¾åº¦å¯¹åº”çš„é¢œè‰²
  getDifficultyColor(difficulty: string): string {
    switch (difficulty) {
      case 'ç®€å•':
        return '#4CAF50'
      case 'ä¸­ç­‰':
        return '#FF9800'
      case 'å›°éš¾':
        return '#F44336'
      default:
        return '#9E9E9E'
    }
  }

  // å‚ä¸ŽæŒ‘æˆ˜
  joinChallenge(challenge: HealthChallenge) {
    if (challenge.progress > 0) {
      JhProgressHUD.showText(`ç»§ç»­åŠ æ²¹ï¼ä½ å·²ç»å®Œæˆäº†${challenge.progress}%çš„è¿›åº¦`);
    } else {
      JhProgressHUD.showText(`æˆåŠŸå‚ä¸Ž${challenge.title}ï¼è®©æˆ‘ä»¬å¼€å§‹è¿™ä¸ªå¥åº·ä¹‹æ—…å§ï¼`);
      // è¿™é‡Œå¯ä»¥æ·»åŠ å®žé™…çš„å‚ä¸Žé€»è¾‘
      challenge.progress = 5; // æ¨¡æ‹Ÿå¼€å§‹è¿›åº¦
      challenge.participants += 1; // å¢žåŠ å‚ä¸Žäººæ•°
    }
  }

  @Builder
  buildChallengeDetailDialog() {
    if (this.selectedChallenge) {
      Stack() {
        // é®ç½©å±‚
        Column()
          .width('100%')
          .height('100%')
          .backgroundColor('rgba(0,0,0,0.5)')
          .onClick(() => {
            this.showChallengeDetailDialog = false;
            this.selectedChallenge = null;
          })

        // å¼¹çª—å†…å®¹
        Column() {
          // å¼¹çª—æ ‡é¢˜æ 
          Row() {
            Text('æŒ‘æˆ˜è¯¦æƒ…')
              .fontSize(20)
              .fontWeight(FontWeight.Bold)
              .fontColor('#333333')

            Blank()

            Button({ type: ButtonType.Circle, stateEffect: true }) {
              Text('âœ•')
                .fontSize(18)
                .fontColor('#666666')
            }
            .width(32)
            .height(32)
            .backgroundColor(Color.Transparent)
            .onClick(() => {
              this.showChallengeDetailDialog = false;
              this.selectedChallenge = null;
            })
          }
          .width('100%')
          .padding({ left: 20, right: 20, top: 20, bottom: 16 })
          .border({
            width: { bottom: 1 },
            color: '#F0F0F0'
          })

          // æ»šåŠ¨å†…å®¹åŒºåŸŸ
          Scroll() {
            Column() {
              // æŒ‘æˆ˜å¤´éƒ¨ä¿¡æ¯
              Row() {
                Text(this.selectedChallenge.icon)
                  .fontSize(48)
                  .margin({ right: 16 })

                Column() {
                  Text(this.selectedChallenge.title)
                    .fontSize(22)
                    .fontWeight(FontWeight.Bold)
                    .fontColor('#333333')
                    .width('100%')
                    .textAlign(TextAlign.Start)

                  Row() {
                    Text(this.selectedChallenge.category)
                      .fontSize(12)
                      .fontColor('#4CAF50')
                      .padding({ left: 8, right: 8, top: 4, bottom: 4 })
                      .backgroundColor('#E8F5E8')
                      .borderRadius(10)

                    Text(this.selectedChallenge.difficulty)
                      .fontSize(12)
                      .fontColor('#FFFFFF')
                      .padding({ left: 8, right: 8, top: 4, bottom: 4 })
                      .backgroundColor(this.getDifficultyColor(this.selectedChallenge.difficulty))
                      .borderRadius(10)
                      .margin({ left: 8 })
                  }
                  .margin({ top: 8 })
                }
                .layoutWeight(1)
                .alignItems(HorizontalAlign.Start)
              }
              .width('100%')
              .margin({ bottom: 20 })

              // æŒ‘æˆ˜æè¿°
              Column() {
                Text('æŒ‘æˆ˜ä»‹ç»')
                  .fontSize(16)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#333333')
                  .width('100%')
                  .textAlign(TextAlign.Start)
                  .margin({ bottom: 12 })

                Text(this.selectedChallenge.detailedDescription)
                  .fontSize(14)
                  .fontColor('#666666')
                  .width('100%')
                  .textAlign(TextAlign.Start)
                  .lineHeight(22)
              }
              .width('100%')
              .padding(16)
              .backgroundColor('#F8F9FA')
              .borderRadius(12)
              .margin({ bottom: 16 })

              // æŒ‘æˆ˜æ—¶é—´
              Column() {
                Text('ðŸ“… æŒ‘æˆ˜æ—¶é—´')
                  .fontSize(16)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#333333')
                  .width('100%')
                  .textAlign(TextAlign.Start)
                  .margin({ bottom: 12 })

                Row() {
                  Column() {
                    Text('å¼€å§‹æ—¶é—´')
                      .fontSize(12)
                      .fontColor('#999999')
                      .margin({ bottom: 4 })

                    Text(this.selectedChallenge.startDate)
                      .fontSize(14)
                      .fontWeight(FontWeight.Medium)
                      .fontColor('#333333')
                  }
                  .layoutWeight(1)
                  .alignItems(HorizontalAlign.Start)

                  Column() {
                    Text('ç»“æŸæ—¶é—´')
                      .fontSize(12)
                      .fontColor('#999999')
                      .margin({ bottom: 4 })

                    Text(this.selectedChallenge.endDate)
                      .fontSize(14)
                      .fontWeight(FontWeight.Medium)
                      .fontColor('#333333')
                  }
                  .layoutWeight(1)
                  .alignItems(HorizontalAlign.Start)

                  Column() {
                    Text('æŒç»­æ—¶é—´')
                      .fontSize(12)
                      .fontColor('#999999')
                      .margin({ bottom: 4 })

                    Text(this.selectedChallenge.duration)
                      .fontSize(14)
                      .fontWeight(FontWeight.Medium)
                      .fontColor('#4CAF50')
                  }
                  .layoutWeight(1)
                  .alignItems(HorizontalAlign.Start)
                }
                .width('100%')
              }
              .width('100%')
              .padding(16)
              .backgroundColor('#FFFFFF')
              .borderRadius(12)
              .border({
                width: 1,
                color: '#E8F5E8'
              })
              .margin({ bottom: 16 })

              // å¥åº·å¥½å¤„
              Column() {
                Text('ðŸ’ª å¥åº·å¥½å¤„')
                  .fontSize(16)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#333333')
                  .width('100%')
                  .textAlign(TextAlign.Start)
                  .margin({ bottom: 12 })

                ForEach(this.selectedChallenge.benefits, (benefit: string, index: number) => {
                  Row() {
                    Text('âœ“')
                      .fontSize(14)
                      .fontColor('#4CAF50')
                      .fontWeight(FontWeight.Bold)
                      .margin({ right: 8 })

                    Text(benefit)
                      .fontSize(14)
                      .fontColor('#666666')
                      .layoutWeight(1)
                      .lineHeight(20)
                  }
                  .width('100%')
                  .margin({ bottom: 8 })
                })
              }
              .width('100%')
              .padding(16)
              .backgroundColor('#F8FFF8')
              .borderRadius(12)
              .margin({ bottom: 16 })

              // æ¯æ—¥ç›®æ ‡
              Column() {
                Text('ðŸŽ¯ æ¯æ—¥ç›®æ ‡')
                  .fontSize(16)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#333333')
                  .width('100%')
                  .textAlign(TextAlign.Start)
                  .margin({ bottom: 12 })

                ForEach(this.selectedChallenge.dailyGoals, (goal: string, index: number) => {
                  Row() {
                    Text(`${index + 1}`)
                      .fontSize(12)
                      .fontColor('#FFFFFF')
                      .textAlign(TextAlign.Center)
                      .width(20)
                      .height(20)
                      .borderRadius(10)
                      .backgroundColor('#FF9800')
                      .margin({ right: 8 })

                    Text(goal)
                      .fontSize(14)
                      .fontColor('#666666')
                      .layoutWeight(1)
                      .lineHeight(20)
                  }
                  .width('100%')
                  .margin({ bottom: 8 })
                })
              }
              .width('100%')
              .padding(16)
              .backgroundColor('#FFF8F0')
              .borderRadius(12)
              .margin({ bottom: 16 })

              // å®žç”¨æŠ€å·§
              Column() {
                Text('ðŸ’¡ å®žç”¨æŠ€å·§')
                  .fontSize(16)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#333333')
                  .width('100%')
                  .textAlign(TextAlign.Start)
                  .margin({ bottom: 12 })

                ForEach(this.selectedChallenge.tips, (tip: string, index: number) => {
                  Row() {
                    Text('ðŸ’¡')
                      .fontSize(14)
                      .margin({ right: 8 })

                    Text(tip)
                      .fontSize(14)
                      .fontColor('#666666')
                      .layoutWeight(1)
                      .lineHeight(20)
                  }
                  .width('100%')
                  .margin({ bottom: 8 })
                })
              }
              .width('100%')
              .padding(16)
              .backgroundColor('#F0F8FF')
              .borderRadius(12)
              .margin({ bottom: 20 })
            }
            .width('100%')
          }
          .layoutWeight(1)
          .padding({ left: 20, right: 20 })
          .scrollBar(BarState.Off)

          // åº•éƒ¨æ“ä½œæŒ‰é’®
          Row() {
            Button('å…³é—­')
              .width('30%')
              .height(44)
              .fontSize(16)
              .fontColor('#666666')
              .backgroundColor('#F5F5F5')
              .borderRadius(22)
              .onClick(() => {
                this.showChallengeDetailDialog = false;
                this.selectedChallenge = null;
              })

            Blank()

            Button(this.selectedChallenge.progress > 0 ? 'ç»§ç»­æŒ‘æˆ˜' : 'ç«‹å³å‚ä¸Ž')
              .width('60%')
              .height(44)
              .fontSize(16)
              .fontColor('#FFFFFF')
              .backgroundColor(this.selectedChallenge.progress > 0 ? '#FF9800' : '#4CAF50')
              .borderRadius(22)
              .onClick(() => {
                this.joinChallenge(this.selectedChallenge!);
                this.showChallengeDetailDialog = false;
                this.selectedChallenge = null;
              })
          }
          .width('100%')
          .padding({ left: 20, right: 20, top: 16, bottom: 20 })
          .backgroundColor('#FFFFFF')
          .border({
            width: { top: 1 },
            color: '#F0F0F0'
          })
        }
        .width('95%')
        .height('85%')
        .backgroundColor('#FFFFFF')
        .borderRadius(20)
        .shadow({
          radius: 30,
          color: 'rgba(0,0,0,0.3)',
          offsetX: 0,
          offsetY: 15
        })
        .alignSelf(ItemAlign.Center)
      }
      .width('100%')
      .height('100%')
      .position({ x: 0, y: 0 })
      .zIndex(1001)
    }
  }

  @Builder
  buildKnowledgeTab() {
    Column({ space: 12 }) {
      Text('å¥åº·çŸ¥è¯†')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .fontColor('#333333')
        .width('100%')
        .textAlign(TextAlign.Start)

      this.buildKnowledgeCard('ðŸƒâ€â™‚ï¸ è¿åŠ¨å¥åº·', 'ç§‘å­¦è¿åŠ¨ï¼Œå¥åº·ç”Ÿæ´»', 'äº†è§£æ­£ç¡®çš„è¿åŠ¨æ–¹å¼å’Œé¢‘çŽ‡ï¼Œè®©è¿åŠ¨æˆä¸ºå¥åº·ç”Ÿæ´»çš„ä¸€éƒ¨åˆ†ã€‚', '#2196F3')
      this.buildKnowledgeCard('ðŸ¥— è¥å…»é¥®é£Ÿ', 'å‡è¡¡è¥å…»ï¼Œåˆç†æ­é…', 'å­¦ä¹ è¥å…»çŸ¥è¯†ï¼ŒæŽŒæ¡å¥åº·é¥®é£Ÿçš„åŽŸåˆ™å’ŒæŠ€å·§ã€‚', '#4CAF50')
      this.buildKnowledgeCard('ðŸ˜´ ç¡çœ ç®¡ç†', 'ä¼˜è´¨ç¡çœ ï¼Œç²¾åŠ›å……æ²›', 'æ”¹å–„ç¡çœ è´¨é‡ï¼Œå»ºç«‹è‰¯å¥½çš„ç¡çœ ä¹ æƒ¯ã€‚', '#9C27B0')
      this.buildKnowledgeCard('ðŸ§˜â€â™€ï¸ å¿ƒç†å¥åº·', 'æƒ…ç»ªç®¡ç†ï¼Œå¿ƒç†å¹³è¡¡', 'å…³æ³¨å¿ƒç†å¥åº·ï¼Œå­¦ä¼šæƒ…ç»ªè°ƒèŠ‚å’ŒåŽ‹åŠ›ç®¡ç†ã€‚', '#FF5722')
    }
    .width('100%')
    .height('100%')
    .padding({ left: 16, right: 16, top: 8, bottom: 20 })
    .backgroundColor('#F8F9FA')
    .alignItems(HorizontalAlign.Center)
    .justifyContent(FlexAlign.Start)
  }

  @Builder
  buildKnowledgeCard(title: string, subtitle: string, description: string, color: string) {
    Column() {
      Row() {
        Column() {
          Text(title)
            .fontSize(16)
            .fontWeight(FontWeight.Bold)
            .fontColor('#333333')
            .width('100%')
            .textAlign(TextAlign.Start)

          Text(subtitle)
            .fontSize(14)
            .fontColor(color)
            .width('100%')
            .textAlign(TextAlign.Start)
            .margin({ top: 4 })
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)

        Text('>')
          .fontSize(20)
          .fontColor('#CCCCCC')
      }
      .width('100%')
      .margin({ bottom: 12 })

      Text(description)
        .fontSize(14)
        .fontColor('#666666')
        .width('100%')
        .textAlign(TextAlign.Start)
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#FFFFFF')
    .borderRadius(12)
    .shadow({
      radius: 6,
      color: 'rgba(0,0,0,0.05)',
      offsetX: 0,
      offsetY: 2
    })
    .onClick(() => {
      this.navigateToKnowledgeDetail(title);
    })
  }

  // å¯¼èˆªåˆ°å¥åº·çŸ¥è¯†è¯¦æƒ…é¡µé¢
  navigateToKnowledgeDetail(title: string) {
    let knowledgeType = '';

    // æ ¹æ®æ ‡é¢˜ç¡®å®šçŸ¥è¯†ç±»åž‹
    if (title.includes('è¿åŠ¨å¥åº·')) {
      knowledgeType = 'exercise';
    } else if (title.includes('è¥å…»é¥®é£Ÿ')) {
      knowledgeType = 'nutrition';
    } else if (title.includes('ç¡çœ ç®¡ç†')) {
      knowledgeType = 'sleep';
    } else if (title.includes('å¿ƒç†å¥åº·')) {
      knowledgeType = 'mental';
    }

    try {
      router.pushUrl({
        url: 'pages/three/pages/HealthKnowledgeDetailPage',
        params: {
          type: knowledgeType
        }
      });
    } catch (err) {
      console.error('Failed to navigate to knowledge detail:', err);
      JhProgressHUD.showText('é¡µé¢è·³è½¬å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•');
    }
  }

  @Builder
  buildMyTab() {
    Column({ space: 12 }) {
      // ä¸ªäººå¥åº·æ¡£æ¡ˆ
      this.buildPersonalHealthProfile()

      // æˆ‘çš„åŠ¨æ€
      this.buildMyPosts()

      // æˆ‘çš„æŒ‘æˆ˜
      this.buildMyChallenges()
    }
    .width('100%')
    .height('100%')
    .padding({ left: 16, right: 16, top: 8, bottom: 20 })
    .backgroundColor('#F8F9FA')
    .alignItems(HorizontalAlign.Center)
    .justifyContent(FlexAlign.Start)
  }

  @Builder
  buildPersonalHealthProfile() {
    Column() {
      Row() {
        Row() {
          Text('æŽ')
            .fontSize(20)
            .fontColor('#FFFFFF')
            .textAlign(TextAlign.Center)
            .width(60)
            .height(60)
            .borderRadius(30)
            .backgroundColor('#4CAF50')
        }
        .margin({ right: 16 })

        Column() {
          Text('æŽé€¸é£ž')
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor('#333333')

          Text('å¥åº·è¾¾äºº Lv.5')
            .fontSize(14)
            .fontColor('#4CAF50')
            .margin({ top: 4 })

          Text('è¿žç»­æ‰“å¡ 15 å¤©')
            .fontSize(12)
            .fontColor('#999999')
            .margin({ top: 2 })
        }
        .alignItems(HorizontalAlign.Start)
        .layoutWeight(1)
      }
      .width('100%')
      .margin({ bottom: 16 })

      // å¥åº·ç»Ÿè®¡
      Row() {
        this.buildStatItem('åŠ¨æ€', '23')
        this.buildStatItem('å…³æ³¨', '156')
        this.buildStatItem('ç²‰ä¸', '89')
        this.buildStatItem('ç§¯åˆ†', '2,340')
      }
      .width('100%')
      .justifyContent(FlexAlign.SpaceAround)
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#FFFFFF')
    .borderRadius(16)
    .shadow({
      radius: 8,
      color: 'rgba(0,0,0,0.06)',
      offsetX: 0,
      offsetY: 3
    })
    .margin({ bottom: 0 })
  }

  @Builder
  buildStatItem(label: string, value: string) {
    Column() {
      Text(value)
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .fontColor('#333333')

      Text(label)
        .fontSize(12)
        .fontColor('#999999')
        .margin({ top: 4 })
    }
    .alignItems(HorizontalAlign.Center)
  }

  @Builder
  buildMyPosts() {
    Column() {
      Row() {
        Text('æˆ‘çš„åŠ¨æ€')
          .fontSize(16)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')

        Blank()

        Text('æŸ¥çœ‹å…¨éƒ¨ >')
          .fontSize(14)
          .fontColor('#4CAF50')
      }
      .width('100%')
      .margin({ bottom: 12 })

      Text('æœ€è¿‘è¿˜æ²¡æœ‰å‘å¸ƒåŠ¨æ€ï¼Œå¿«æ¥åˆ†äº«ä½ çš„å¥åº·ç”Ÿæ´»å§ï¼')
        .fontSize(14)
        .fontColor('#999999')
        .width('100%')
        .textAlign(TextAlign.Center)
        .padding({ top: 20, bottom: 20 })
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#FFFFFF')
    .borderRadius(12)
    .shadow({
      radius: 6,
      color: 'rgba(0,0,0,0.05)',
      offsetX: 0,
      offsetY: 2
    })
    .margin({ bottom: 0 })
  }

  @Builder
  buildMyChallenges() {
    Column() {
      Row() {
        Text('æˆ‘çš„æŒ‘æˆ˜')
          .fontSize(16)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')

        Blank()

        Text('æŸ¥çœ‹å…¨éƒ¨ >')
          .fontSize(14)
          .fontColor('#4CAF50')
      }
      .width('100%')
      .margin({ bottom: 12 })

      Row() {
        Text('ðŸƒâ€â™‚ï¸')
          .fontSize(24)
          .margin({ right: 12 })

        Column() {
          Text('30å¤©æ­¥è¡ŒæŒ‘æˆ˜')
            .fontSize(14)
            .fontWeight(FontWeight.Medium)
            .fontColor('#333333')
            .width('100%')
            .textAlign(TextAlign.Start)

          Text('è¿›åº¦: 15/30 å¤©')
            .fontSize(12)
            .fontColor('#999999')
            .width('100%')
            .textAlign(TextAlign.Start)
            .margin({ top: 2 })
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)

        Text('50%')
          .fontSize(14)
          .fontColor('#4CAF50')
          .fontWeight(FontWeight.Bold)
      }
      .width('100%')
      .padding(12)
      .backgroundColor('#F8F9FA')
      .borderRadius(8)
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#FFFFFF')
    .borderRadius(12)
    .shadow({
      radius: 6,
      color: 'rgba(0,0,0,0.05)',
      offsetX: 0,
      offsetY: 2
    })
    .margin({ bottom: 0 })
  }

  // èŽ·å–åŠ¨æ€ç±»åž‹å›¾æ ‡
  getPostTypeIcon(type: HealthPostType): string {
    switch (type) {
      case HealthPostType.EXERCISE:
        return 'ðŸƒâ€â™‚ï¸'
      case HealthPostType.DIET:
        return 'ðŸ¥—'
      case HealthPostType.SLEEP:
        return 'ðŸ˜´'
      case HealthPostType.MOOD:
        return 'ðŸ˜Š'
      case HealthPostType.CHALLENGE:
        return 'ðŸ†'
      case HealthPostType.KNOWLEDGE:
        return 'ðŸ“š'
      default:
        return 'ðŸ’š'
    }
  }

  // åŠ è½½å¥åº·æ•°æ®
  loadHealthData() {
    // æ¨¡æ‹Ÿå¥åº·åŠ¨æ€æ•°æ®
    this.healthPosts = [
      new HealthPost(
        '1',
        'å¥åº·å°è¾¾äºº',
        '',
        'å¥åº·è¾¾äºº',
        HealthPostType.EXERCISE,
        'ä»Šæ—¥è¿åŠ¨æ‰“å¡',
        'ä»Šå¤©å®Œæˆäº†5å…¬é‡Œæ™¨è·‘ï¼Œæ„Ÿè§‰ç²¾ç¥žçŠ¶æ€ç‰¹åˆ«å¥½ï¼åšæŒè¿åŠ¨çœŸçš„èƒ½è®©äººå……æ»¡æ´»åŠ›ã€‚',
        [],
        new HealthMetrics(8756, 420, 75, undefined, undefined),
        '2å°æ—¶å‰',
        23,
        5,
        false,
        ['æ™¨è·‘', 'å¥åº·ç”Ÿæ´»', 'è¿åŠ¨æ‰“å¡']
      ),
      new HealthPost(
        '2',
        'è¥å…»å¸ˆå°çŽ‹',
        '',
        'è¥å…»ä¸“å®¶',
        HealthPostType.DIET,
        'å¥åº·é¥®é£Ÿåˆ†äº«',
        'ä»Šå¤©ä¸ºå¤§å®¶åˆ†äº«ä¸€ä¸ªè¥å…»å‡è¡¡çš„æ—©é¤æ­é…ï¼šç‡•éº¦ç²¥+æ°´ç…®è›‹+è”¬èœæ²™æ‹‰ï¼Œæ—¢ç¾Žå‘³åˆå¥åº·ï¼',
        [],
        new HealthMetrics(undefined, 350, undefined, undefined, undefined),
        '4å°æ—¶å‰',
        45,
        12,
        true,
        ['å¥åº·é¥®é£Ÿ', 'è¥å…»æ­é…', 'æ—©é¤']
      ),
      new HealthPost(
        '3',
        'ç¡çœ ä¸“å®¶',
        '',
        'ç¡çœ é¡¾é—®',
        HealthPostType.SLEEP,
        'ä¼˜è´¨ç¡çœ å¿ƒå¾—',
        'åˆ†äº«ä¸€ä¸ªæ”¹å–„ç¡çœ è´¨é‡çš„å°æŠ€å·§ï¼šç¡å‰1å°æ—¶ä¸çœ‹æ‰‹æœºï¼Œå¬å¬è½»éŸ³ä¹ï¼Œæ•ˆæžœå¾ˆä¸é”™ï¼',
        [],
        new HealthMetrics(undefined, undefined, undefined, 8.5, undefined),
        'æ˜¨å¤©',
        67,
        18,
        false,
        ['ç¡çœ è´¨é‡', 'å¥åº·ä¹ æƒ¯', 'ç”Ÿæ´»æŠ€å·§']
      )
    ]

    // æ¨¡æ‹Ÿå¥åº·æŒ‘æˆ˜æ•°æ®
    this.healthChallenges = [
      new HealthChallenge(
        '1',
        '30å¤©æ­¥è¡ŒæŒ‘æˆ˜',
        'æ¯å¤©å®Œæˆ8000æ­¥ï¼ŒåšæŒ30å¤©',
        'é€šè¿‡30å¤©çš„åšæŒæ­¥è¡Œï¼Œå…»æˆè‰¯å¥½çš„è¿åŠ¨ä¹ æƒ¯ã€‚æ¯å¤©8000æ­¥æ˜¯ä¸–ç•Œå«ç”Ÿç»„ç»‡æŽ¨èçš„åŸºç¡€è¿åŠ¨é‡ï¼Œèƒ½å¤Ÿæœ‰æ•ˆæé«˜å¿ƒè‚ºåŠŸèƒ½ï¼Œå¢žå¼ºä¸‹è‚¢è‚Œè‚‰åŠ›é‡ï¼Œä¿ƒè¿›æ–°é™ˆä»£è°¢ï¼Œå¸®åŠ©æŽ§åˆ¶ä½“é‡ã€‚è¿™ä¸ªæŒ‘æˆ˜é€‚åˆæ‰€æœ‰å¹´é¾„æ®µçš„äººç¾¤ï¼Œæ— éœ€ç‰¹æ®Šè£…å¤‡ï¼Œéšæ—¶éšåœ°éƒ½å¯ä»¥è¿›è¡Œã€‚',
        'ðŸš¶â€â™‚ï¸',
        1234,
        '30å¤©',
        '500',
        50,
        'è¿åŠ¨å¥åº·',
        'ä¸­ç­‰',
        [
          'æé«˜å¿ƒè‚ºåŠŸèƒ½ï¼Œå¢žå¼ºä½“è´¨',
          'ä¿ƒè¿›è¡€æ¶²å¾ªçŽ¯ï¼Œé¢„é˜²å¿ƒè¡€ç®¡ç–¾ç—…',
          'å¢žå¼ºä¸‹è‚¢è‚Œè‚‰åŠ›é‡å’Œéª¨å¯†åº¦',
          'å¸®åŠ©æŽ§åˆ¶ä½“é‡ï¼Œç‡ƒçƒ§å¤šä½™è„‚è‚ª',
          'æ”¹å–„ç¡çœ è´¨é‡ï¼Œç¼“è§£åŽ‹åŠ›',
          'æå‡ç²¾ç¥žçŠ¶æ€ï¼Œå¢žå¼ºè‡ªä¿¡å¿ƒ'
        ],
        [
          'æ¯å¤©æ­¥è¡Œ8000æ­¥ä»¥ä¸Š',
          'è®°å½•æ¯æ—¥æ­¥æ•°å’Œè¿åŠ¨æ—¶é•¿',
          'é€‰æ‹©ä¸åŒè·¯çº¿ï¼Œå¢žåŠ è¶£å‘³æ€§',
          'ä¿æŒåŒ€é€Ÿæ­¥è¡Œï¼Œé¿å…è¿‡åº¦ç–²åŠ³',
          'ç©¿ç€èˆ’é€‚çš„è¿åŠ¨éž‹',
          'é€‚å½“è¡¥å……æ°´åˆ†'
        ],
        [
          'å¯ä»¥åˆ†å¤šæ¬¡å®Œæˆï¼Œå¦‚æ—©ä¸­æ™šå„èµ°ä¸€æ®µ',
          'åˆ©ç”¨ä¸Šä¸‹ç­æ—¶é—´æ­¥è¡Œï¼Œä¸€ä¸¾ä¸¤å¾—',
          'é‚€è¯·æœ‹å‹å®¶äººä¸€èµ·å‚ä¸Žï¼Œäº’ç›¸ç›‘ç£',
          'ä½¿ç”¨è®¡æ­¥å™¨æˆ–æ‰‹æœºAPPè®°å½•è¿›åº¦',
          'é€‰æ‹©é£Žæ™¯ä¼˜ç¾Žçš„è·¯çº¿ï¼Œäº«å—è¿‡ç¨‹',
          'é›¨å¤©å¯åœ¨å®¤å†…èµ°æ¥¼æ¢¯æˆ–åŽŸåœ°è¸æ­¥'
        ],
        '2024-11-01',
        '2024-11-30'
      ),
      new HealthChallenge(
        '2',
        'å¥åº·é¥®é£Ÿ21å¤©',
        '21å¤©å¥åº·é¥®é£Ÿä¹ æƒ¯å…»æˆ',
        'ç§‘å­¦ç ”ç©¶è¡¨æ˜Žï¼Œ21å¤©æ˜¯å…»æˆä¸€ä¸ªæ–°ä¹ æƒ¯çš„æœ€çŸ­å‘¨æœŸã€‚é€šè¿‡21å¤©çš„å¥åº·é¥®é£Ÿå®žè·µï¼Œå¸®åŠ©ä½ å»ºç«‹ç§‘å­¦çš„è¥å…»æ­é…è§‚å¿µï¼Œå­¦ä¼šåˆç†æŽ§åˆ¶çƒ­é‡æ‘„å…¥ï¼Œå¢žåŠ è”¬èœæ°´æžœçš„æ¯”ä¾‹ï¼Œå‡å°‘é«˜ç³–é«˜è„‚é£Ÿç‰©ï¼ŒåŸ¹å…»æ¸…æ·¡é¥®é£Ÿçš„ä¹ æƒ¯ï¼Œä¸ºé•¿æœŸçš„å¥åº·ç”Ÿæ´»å¥ å®šåŸºç¡€ã€‚',
        'ðŸ¥—',
        856,
        '21å¤©',
        '300',
        0,
        'è¥å…»é¥®é£Ÿ',
        'ç®€å•',
        [
          'å»ºç«‹ç§‘å­¦çš„é¥®é£Ÿç»“æž„å’Œä¹ æƒ¯',
          'æŽ§åˆ¶ä½“é‡ï¼Œé¢„é˜²è‚¥èƒ–ç›¸å…³ç–¾ç—…',
          'æä¾›å……è¶³è¥å…»ï¼Œå¢žå¼ºå…ç–«åŠ›',
          'æ”¹å–„è‚ é“å¥åº·ï¼Œä¿ƒè¿›æ¶ˆåŒ–',
          'ç¨³å®šè¡€ç³–ï¼Œé¢„é˜²ç³–å°¿ç—…',
          'æå‡çš®è‚¤çŠ¶æ€ï¼Œå»¶ç¼“è¡°è€'
        ],
        [
          'æ¯é¤åŒ…å«è›‹ç™½è´¨ã€ç¢³æ°´åŒ–åˆç‰©ã€è”¬èœ',
          'æ¯å¤©æ‘„å…¥5-7ä»½ä¸åŒé¢œè‰²çš„è”¬æžœ',
          'é€‰æ‹©å…¨è°·ç‰©é£Ÿå“ï¼Œå‡å°‘ç²¾åˆ¶ç³–',
          'æŽ§åˆ¶æ²¹ç›æ‘„å…¥ï¼Œæ¸…æ·¡é¥®é£Ÿ',
          'è§„å¾‹ç”¨é¤ï¼Œé¿å…æš´é¥®æš´é£Ÿ',
          'æ¯å¤©é¥®æ°´1500-2000ml'
        ],
        [
          'æå‰è§„åˆ’ä¸€å‘¨çš„èœè°±ï¼Œé¿å…ä¸´æ—¶å†³å®š',
          'å­¦ä¹ çœ‹é£Ÿå“è¥å…»æ ‡ç­¾ï¼Œé€‰æ‹©å¥åº·é£Ÿå“',
          'ç”¨å°ç›˜å­ç››é¥­ï¼Œæœ‰åŠ©äºŽæŽ§åˆ¶é£Ÿé‡',
          'ç»†åš¼æ…¢å’½ï¼Œæ¯å£å’€åš¼20-30æ¬¡',
          'é¥­å‰å–ä¸€æ¯æ°´ï¼Œå¢žåŠ é¥±è…¹æ„Ÿ',
          'å‡†å¤‡å¥åº·é›¶é£Ÿï¼Œå¦‚åšæžœã€æ°´æžœ'
        ],
        '2024-11-01',
        '2024-11-21'
      ),
      new HealthChallenge(
        '3',
        'æ—©ç¡æ—©èµ·æŒ‘æˆ˜',
        'è¿žç»­14å¤©23:00å‰ç¡è§‰ï¼Œ7:00å‰èµ·åºŠ',
        'çŽ°ä»£äººæ™®éå­˜åœ¨ç¡çœ ä¸è¶³å’Œä½œæ¯ä¸è§„å¾‹çš„é—®é¢˜ã€‚é€šè¿‡14å¤©çš„æ—©ç¡æ—©èµ·æŒ‘æˆ˜ï¼Œå¸®åŠ©ä½ é‡æ–°è°ƒæ•´ç”Ÿç‰©é’Ÿï¼Œå»ºç«‹å¥åº·çš„ç¡çœ æ¨¡å¼ã€‚å……è¶³çš„ç¡çœ æ˜¯èº«ä½“ä¿®å¤å’Œå¤§è„‘æ•´ç†è®°å¿†çš„é‡è¦æ—¶é—´ï¼Œè§„å¾‹çš„ä½œæ¯èƒ½æ˜¾è‘—æå‡ç”Ÿæ´»è´¨é‡å’Œå·¥ä½œæ•ˆçŽ‡ã€‚',
        'ðŸ˜´',
        567,
        '14å¤©',
        '200',
        25,
        'ç¡çœ å¥åº·',
        'ç®€å•',
        [
          'è°ƒæ•´ç”Ÿç‰©é’Ÿï¼Œå»ºç«‹è§„å¾‹ä½œæ¯',
          'æé«˜ç¡çœ è´¨é‡ï¼Œå¢žå¼ºè®°å¿†åŠ›',
          'å¢žå¼ºå…ç–«ç³»ç»Ÿï¼Œé¢„é˜²ç–¾ç—…',
          'æ”¹å–„æƒ…ç»ªçŠ¶æ€ï¼Œå‡å°‘ç„¦è™‘',
          'æå‡å·¥ä½œæ•ˆçŽ‡å’Œä¸“æ³¨åŠ›',
          'ä¿ƒè¿›ç”Ÿé•¿æ¿€ç´ åˆ†æ³Œï¼Œå»¶ç¼“è¡°è€'
        ],
        [
          'æ¯æ™š23:00å‰ä¸ŠåºŠç¡è§‰',
          'æ¯å¤©7:00å‰èµ·åºŠï¼Œä¸èµ–åºŠ',
          'ä¿è¯7-8å°æ—¶çš„ç¡çœ æ—¶é—´',
          'ç¡å‰1å°æ—¶ä¸ä½¿ç”¨ç”µå­è®¾å¤‡',
          'åˆ›é€ èˆ’é€‚çš„ç¡çœ çŽ¯å¢ƒ',
          'è®°å½•ç¡çœ è´¨é‡å’Œèµ·åºŠæ„Ÿå—'
        ],
        [
          'ç¡å‰2å°æ—¶é¿å…å‰§çƒˆè¿åŠ¨',
          'å¯ä»¥å¬è½»æŸ”éŸ³ä¹æˆ–å†¥æƒ³æ”¾æ¾',
          'ä¿æŒå§å®¤æ¸©åº¦åœ¨18-22åº¦',
          'ä½¿ç”¨é®å…‰çª—å¸˜ï¼Œè¥é€ é»‘æš—çŽ¯å¢ƒ',
          'å»ºç«‹å›ºå®šçš„ç¡å‰ä»ªå¼',
          'å‘¨æœ«ä¹Ÿè¦ä¿æŒç›¸åŒçš„ä½œæ¯æ—¶é—´'
        ],
        '2024-11-01',
        '2024-11-14'
      )
    ]
  }

  // å‘å¸ƒåŠ¨æ€å¼¹çª—
  @Builder
  buildPostDialog() {
    Stack() {
      // é®ç½©å±‚
      Column()
        .width('100%')
        .height('100%')
        .backgroundColor('rgba(0,0,0,0.5)')
        .onClick(() => {
          this.showPostDialog = false;
          this.resetPostForm();
        })

      // å¼¹çª—å†…å®¹
      Column() {
        // å¼¹çª—æ ‡é¢˜
        Row() {
          Text('å–æ¶ˆ')
            .fontSize(16)
            .fontColor('#666666')
            .onClick(() => {
              this.showPostDialog = false;
              this.resetPostForm();
            })

          Blank()

          Text('å‘å¸ƒåŠ¨æ€')
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor('#333333')

          Blank()

          Text('å‘å¸ƒ')
            .fontSize(16)
            .fontColor('#4CAF50')
            .fontWeight(FontWeight.Bold)
            .onClick(() => {
              this.publishPost();
            })
        }
        .width('100%')
        .padding({ left: 20, right: 20, top: 16, bottom: 16 })
        .border({
          width: { bottom: 1 },
          color: '#F0F0F0'
        })

        // åŠ¨æ€ç±»åž‹é€‰æ‹©
        Column() {
          Text('é€‰æ‹©åŠ¨æ€ç±»åž‹')
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor('#333333')
            .width('100%')
            .textAlign(TextAlign.Start)
            .margin({ bottom: 12 })

          Row() {
            ForEach(this.postTypes, (postType: PostTypeOption) => {
              Column() {
                Text(postType.icon)
                  .fontSize(24)
                  .margin({ bottom: 4 })

                Text(postType.name)
                  .fontSize(12)
                  .fontColor(this.selectedPostType === postType.type ? '#4CAF50' : '#666666')
              }
              .padding(8)
              .backgroundColor(this.selectedPostType === postType.type ? '#E8F5E8' : '#F8F9FA')
              .borderRadius(8)
              .border({
                width: this.selectedPostType === postType.type ? 2 : 1,
                color: this.selectedPostType === postType.type ? '#4CAF50' : '#E0E0E0'
              })
              .onClick(() => {
                this.selectedPostType = postType.type;
              })
            })
          }
          .width('100%')
          .justifyContent(FlexAlign.SpaceAround)
        }
        .width('100%')
        .padding({ left: 20, right: 20, top: 16, bottom: 16 })
        .border({
          width: { bottom: 1 },
          color: '#F0F0F0'
        })

        // æ ‡é¢˜è¾“å…¥
        Column() {
          Text('åŠ¨æ€æ ‡é¢˜')
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor('#333333')
            .width('100%')
            .textAlign(TextAlign.Start)
            .margin({ bottom: 8 })

          TextInput({ placeholder: 'è¯·è¾“å…¥åŠ¨æ€æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰', text: this.inputTitle })
            .width('100%')
            .height(40)
            .fontSize(14)
            .backgroundColor('#F8F9FA')
            .borderRadius(8)
            .border({
              width: 1,
              color: '#E0E0E0'
            })
            .onChange((value: string) => {
              this.inputTitle = value;
            })
        }
        .width('100%')
        .padding({ left: 20, right: 20, top: 16, bottom: 16 })
        .border({
          width: { bottom: 1 },
          color: '#F0F0F0'
        })

        // å†…å®¹è¾“å…¥
        Column() {
          Text('åŠ¨æ€å†…å®¹')
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor('#333333')
            .width('100%')
            .textAlign(TextAlign.Start)
            .margin({ bottom: 8 })

          TextArea({ placeholder: 'åˆ†äº«ä½ çš„å¥åº·ç”Ÿæ´»...', text: this.inputContent })
            .width('100%')
            .height(100)
            .fontSize(14)
            .backgroundColor('#F8F9FA')
            .borderRadius(8)
            .border({
              width: 1,
              color: '#E0E0E0'
            })
            .onChange((value: string) => {
              this.inputContent = value;
            })
        }
        .width('100%')
        .padding({ left: 20, right: 20, top: 16, bottom: 16 })
        .border({
          width: { bottom: 1 },
          color: '#F0F0F0'
        })

        // æ ‡ç­¾è¾“å…¥
        Column() {
          Text('æ·»åŠ æ ‡ç­¾')
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor('#333333')
            .width('100%')
            .textAlign(TextAlign.Start)
            .margin({ bottom: 8 })

          TextInput({ placeholder: 'è¯·è¾“å…¥æ ‡ç­¾ï¼Œç”¨ç©ºæ ¼åˆ†éš”', text: this.inputTags })
            .width('100%')
            .height(40)
            .fontSize(14)
            .backgroundColor('#F8F9FA')
            .borderRadius(8)
            .border({
              width: 1,
              color: '#E0E0E0'
            })
            .onChange((value: string) => {
              this.inputTags = value;
            })

          Text('ä¾‹å¦‚ï¼šè¿åŠ¨ å¥åº· æ‰“å¡')
            .fontSize(12)
            .fontColor('#999999')
            .margin({ top: 4 })
        }
        .width('100%')
        .padding({ left: 20, right: 20, top: 16, bottom: 20 })
      }
      .width('90%')
      .backgroundColor('#FFFFFF')
      .borderRadius(16)
      .shadow({
        radius: 20,
        color: 'rgba(0,0,0,0.2)',
        offsetX: 0,
        offsetY: 10
      })
      .alignSelf(ItemAlign.Center)
    }
    .width('100%')
    .height('100%')
    .position({ x: 0, y: 0 })
    .zIndex(1000)
  }

  // é‡ç½®å‘å¸ƒè¡¨å•
  resetPostForm() {
    this.inputTitle = '';
    this.inputContent = '';
    this.inputTags = '';
    this.selectedPostType = HealthPostType.EXERCISE;
  }

  // å‘å¸ƒåŠ¨æ€
  publishPost() {
    if (!this.inputContent.trim()) {
      JhProgressHUD.showText('è¯·è¾“å…¥åŠ¨æ€å†…å®¹');
      return;
    }

    // å¤„ç†æ ‡ç­¾
    const tags = this.inputTags.trim() ? this.inputTags.trim().split(' ').filter((tag: string) => tag.length > 0) : [];

    // åˆ›å»ºæ–°åŠ¨æ€
    const newPost = new HealthPost(
      Date.now().toString(),
      'æŽé€¸é£ž', // å½“å‰ç”¨æˆ·å
      '',
      'å¥åº·è¾¾äºº',
      this.selectedPostType,
      this.inputTitle.trim(),
      this.inputContent.trim(),
      [],
      new HealthMetrics(8756, 420, 72, 7.5, undefined), // æ¨¡æ‹Ÿå½“å‰å¥åº·æ•°æ®
      'åˆšåˆš',
      0,
      0,
      false,
      tags
    );

    // æ·»åŠ åˆ°åŠ¨æ€åˆ—è¡¨é¡¶éƒ¨
    this.healthPosts.unshift(newPost);

    // å…³é—­å¼¹çª—å¹¶é‡ç½®è¡¨å•
    this.showPostDialog = false;
    this.resetPostForm();

    // æ˜¾ç¤ºæˆåŠŸæç¤º
    JhProgressHUD.showText('åŠ¨æ€å‘å¸ƒæˆåŠŸï¼');
  }

  // åˆ‡æ¢åŠ¨æ€ç‚¹èµžçŠ¶æ€
  togglePostLike(post: HealthPost) {
    post.isLiked = !post.isLiked;
    post.likes += post.isLiked ? 1 : -1;
  }
}
